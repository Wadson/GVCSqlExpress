using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    internal class CidadeMODEL
    {
        public int CidadeID { get; set; }
        public string Nome { get; set; }
        public int EstadoID { get; set; }        

    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    // Este DTO é usado APENAS para exibir no ComboBox
    public class ClienteDisplayDTO
    {
        public int Id { get; set; }
        public string Nome { get; set; }
        public string Documento { get; set; }
        public string DisplayText => $"{Nome} | {Documento}";

        // Construtor para facilitar
        public ClienteDisplayDTO(int id, string nome, string documento)
        {
            Id = id;
            Nome = nome;
            Documento = documento;
        }
    }
}
﻿using GVC.DALL;
using Microsoft.Data.SqlClient;
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ClienteMODEL
    {
        public int ClienteID { get; set; }
        public string Nome { get; set; }
        public string Cpf { get; set; }
        public string RG { get; set; }
        public string Cnpj { get; set; }
        public string IE { get; set; }
        public string Telefone { get; set; }
        public string Email { get; set; }
        public int? CidadeID { get; set; }   // bigint no banco → int? na classe
        public string OrgaoExpedidorRG { get; set; }
        // Endereço detalhado
        public string Logradouro { get; set; }
        public string Numero { get; set; }
        public string Bairro { get; set; }
        public string Cep { get; set; }
        public bool? IsVendedor { get; set; } 
        // bit NULL

        // Dados adicionais do cliente
        public DateTime? DataNascimento { get; set; }   // datetime NULL
        public string TipoCliente { get; set; }         // nvarchar(20)

        // Status (no banco é bigint DEFAULT 1)
        public long Status { get; set; } = 1;           // refletindo fielmente o banco

        public string Observacoes { get; set; }

        // Controle financeiro
        public DateTime? DataUltimaCompra { get; set; }
        public decimal? LimiteCredito { get; set; }     // real → decimal?

        // Auditoria
        public DateTime DataCriacao { get; set; } = DateTime.Now;
        public DateTime? DataAtualizacao { get; set; }
        public string UsuarioCriacao { get; set; }
        public string UsuarioAtualizacao { get; set; }

        public static implicit operator Cliente(ClienteMODEL v)
        {
            return new Cliente
            {
                ClienteID = v.ClienteID,
                Nome = v.Nome ?? "",
                Telefone = v.Telefone ?? "",
                CPF = v.Cpf ?? ""
            };
        }
    }

}﻿using Microsoft.Data.SqlClient;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ClienteService
    {
        private readonly string _connectionString;

        public ClienteService(string connectionString)
        {
            _connectionString = connectionString;
        }

        // Método SIMPLES para buscar clientes
        public async Task<List<ClienteDisplayDTO>> BuscarClientesAsync(string busca)
        {
            var lista = new List<ClienteDisplayDTO>();

            try
            {
                using (var conn = new SqlConnection(_connectionString))
                {
                    await conn.OpenAsync();

                    string sql = @"
                        SELECT TOP 20 
                            ClienteID, 
                            Nome,
                            ISNULL(CPF, '') as CPF,
                            ISNULL(CNPJ, '') as CNPJ
                        FROM Clientes 
                        WHERE Ativo = 1 
                          AND (Nome LIKE @Busca OR 
                               CPF LIKE @Busca OR 
                               CNPJ LIKE @Busca)
                        ORDER BY Nome";

                    using (var cmd = new SqlCommand(sql, conn))
                    {
                        cmd.Parameters.AddWithValue("@Busca", $"%{busca}%");

                        using (var reader = await cmd.ExecuteReaderAsync())
                        {
                            while (await reader.ReadAsync())
                            {
                                int id = reader.GetInt32(0);
                                string nome = reader.GetString(1);
                                string cpf = reader.GetString(2);
                                string cnpj = reader.GetString(3);

                                // Decide qual documento mostrar
                                string documento = !string.IsNullOrEmpty(cpf) ?
                                    FormatCPF(cpf) :
                                    !string.IsNullOrEmpty(cnpj) ?
                                    FormatCNPJ(cnpj) : "";

                                lista.Add(new ClienteDisplayDTO(id, nome, documento));
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                // Em produção, logaria o erro
                Console.WriteLine($"Erro ao buscar clientes: {ex.Message}");
            }

            return lista;
        }

        private string FormatCPF(string cpf)
        {
            if (cpf.Length == 11)
                return Convert.ToUInt64(cpf).ToString(@"000\.000\.000\-00");
            return cpf;
        }

        private string FormatCNPJ(string cnpj)
        {
            if (cnpj.Length == 14)
                return Convert.ToUInt64(cnpj).ToString(@"00\.000\.000\/0000\-00");
            return cnpj;
        }

        // Método para obter cliente por ID
        public async Task<ClienteDisplayDTO> ObterClientePorIdAsync(int clienteId)
        {
            try
            {
                using (var conn = new SqlConnection(_connectionString))
                {
                    await conn.OpenAsync();

                    string sql = "SELECT ClienteID, Nome, CPF, CNPJ FROM Clientes WHERE ClienteID = @Id";

                    using (var cmd = new SqlCommand(sql, conn))
                    {
                        cmd.Parameters.AddWithValue("@Id", clienteId);

                        using (var reader = await cmd.ExecuteReaderAsync())
                        {
                            if (await reader.ReadAsync())
                            {
                                string nome = reader.GetString(1);
                                string cpf = reader.GetString(2);
                                string cnpj = reader.GetString(3);

                                string documento = !string.IsNullOrEmpty(cpf) ?
                                    FormatCPF(cpf) :
                                    !string.IsNullOrEmpty(cnpj) ?
                                    FormatCNPJ(cnpj) : "";

                                return new ClienteDisplayDTO(clienteId, nome, documento);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Erro ao obter cliente: {ex.Message}");
            }

            return null;
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ContaAReceberDTO
    {
        public int ParcelaID { get; set; }
        public int VendaID { get; set; }
        public int NumeroParcela { get; set; }
        public string NomeCliente { get; set; }
        public DateTime DataVenda { get; set; }
        public DateTime DataVencimento { get; set; }
        public decimal ValorParcela { get; set; }
        public decimal ValorRecebido { get; set; }
        public decimal Saldo { get; set; }
        public string StatusParcela { get; set; }
        public string FormaPgto { get; set; }
        public string Observacoes { get; set; } // ⬅️ aqui
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class EmpresaModel
    {
        public int EmpresaID { get; set; }
        public string RazaoSocial { get; set; }
        public string NomeFantasia { get; set; }
        public string CNPJ { get; set; }
        public string InscricaoEstadual { get; set; }
        public string InscricaoMunicipal { get; set; }
        public string CNAE { get; set; }
        public int Status { get; set; } // ✅ novo campo
        public string Logradouro { get; set; }
        public string Numero { get; set; }
        public string Bairro { get; set; }
        public string Cep { get; set; }
        public string Cidade { get; set; }
        public string UF { get; set; }

        public string Telefone { get; set; }
        public string Email { get; set; }
        public string Site { get; set; }

        public string Responsavel { get; set; }
        public string CertificadoDigital { get; set; }

        public DateTime DataCriacao { get; set; }
        public DateTime? DataAtualizacao { get; set; }
        public string UsuarioCriacao { get; set; }
        public string UsuarioAtualizacao { get; set; }
        public byte[] Logo { get; set; }

    }

}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    internal class EstadoMODEL
    {
        public int EstadoID { get; set; }
        public string Nome { get; set; }
        public string UF { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ExtratoCliente
    {
        public long ClienteID { get; set; }
        public string NomeCliente { get; set; }
        public string CPF_CNPJ { get; set; }
        public string Endereco { get; set; }
        public string Telefone { get; set; }
        public DateTime DataEmissao { get; set; } = DateTime.Now;
        public List<ItemExtrato> ItensExtrato { get; set; } = new List<ItemExtrato>();
        public decimal TotalDevendo { get; set; }
        public decimal TotalPago { get; set; }
        public decimal SaldoAtual { get; set; }
    }

    public class ItemExtrato
    {
        public DateTime DataVenda { get; set; }
        public long VendaID { get; set; }
        public string Descricao { get; set; }
        public int NumeroParcela { get; set; }
        public DateTime DataVencimento { get; set; }
        public DateTime? DataPagamento { get; set; }
        public decimal ValorParcela { get; set; }
        public decimal ValorRecebido { get; set; }
        public decimal Desconto { get; set; }
        public decimal Juros { get; set; }
        public decimal Saldo { get; set; }
        public string Status { get; set; }
        public string FormaPagamento { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Text;

namespace GVC.MODEL
{
    internal class FormaPgtoMODEL
    {
        public int FormaPgtoID { get; set; }
        public string NomeFormaPgto { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class FornecedorModel
    {
        public long FornecedorID { get; set; }          // INTEGER AUTOINCREMENT → long
        public string Nome { get; set; }                // nvarchar(100) NOT NULL
        public string? Cnpj { get; set; }               // nvarchar(14) NULL
        public string? IE { get; set; }                 // nvarchar(20) NULL
        public string? Telefone { get; set; }           // nvarchar(20) NULL
        public string? Email { get; set; }              // nvarchar(100) NULL
        public long CidadeID { get; set; }              // bigint NOT NULL (FK para Cidade)
        public string? Logradouro { get; set; }         // nvarchar(150) NULL
        public string? Numero { get; set; }             // nvarchar(10) NULL
        public string? Bairro { get; set; }             // nvarchar(100) NULL
        public string? Cep { get; set; }                // nvarchar(10) NULL
        public DateTime? DataCriacao { get; set; }      // datetime NULL
        public string? Observacoes { get; set; }
    }

}﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ItensExtrato
    {
        public DateTime DataVenda { get; set; }
        public long VendaID { get; set; }
        public string Descricao { get; set; }
        public int NumeroParcela { get; set; }
        public DateTime DataVencimento { get; set; }
        public DateTime? DataPagamento { get; set; }
        public decimal ValorParcela { get; set; }
        public decimal ValorRecebido { get; set; }
        public decimal Desconto { get; set; }
        public decimal Juros { get; set; }
        public decimal Saldo { get; set; }
        public string Status { get; set; }
        public string FormaPagamento { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ItemVendaModel
    {
        public long ItemVendaID { get; set; }
        public long VendaID { get; set; }
        public long ProdutoID { get; set; }
       

        public string ProdutoDescricao { get; set; } // 🔥 ESSENCIAL       

        // 🔴 bigint → long
        public long Quantidade { get; set; }

        // 🔴 dinheiro → decimal
        public decimal PrecoUnitario { get; set; }
        public decimal? Subtotal { get; set; }
        public decimal? DescontoItem { get; set; }

        public VendaModel Venda { get; set; }
    }

}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class MovimentacaoEstoqueModel
    {
        public int MovimentacaoID { get; set; }
        public int ProdutoID { get; set; }
        public string TipoMovimentacao { get; set; } // Entrada | Saida | Ajuste
        public int Quantidade { get; set; }
        public int EstoqueAnterior { get; set; }
        public int EstoqueAtual { get; set; }
        public string Origem { get; set; }
        public string Documento { get; set; }
        public string Observacao { get; set; }
        public DateTime DataMovimentacao { get; set; }
        public string Usuario { get; set; }
    }

}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    internal class PagamentoMODEL
    {
        public long PagamentoID { get; set; }
        public long ParcelaID { get; set; }
        public DateTime DataPagamento { get; set; }
        public decimal ValorPago { get; set; }
        public string MetodoPagamento { get; set; }
        public string Observacao { get; set; }

        // Construtor padrão        
    }
}
﻿using GVC.DALL;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    internal class PagamentoParcialModel
    {
        public long PagamentoID { get; set; } // ID do pagamento parcial, chave primária
        public long ParcelaID { get; set; } // ID da parcela associada
        public decimal ValorPago { get; set; } // Valor pago na parcela
        public DateTime DataPagamento { get; set; } = DateTime.Now;

        // Propriedade de navegação opcional para a Parcela
       

        public static implicit operator PagamentoParcialModel(PagamentoParcialDal v)
        {
            throw new NotImplementedException();
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    internal class ParcelaExtrato
    {
        public long ParcelaID { get; set; }
        public long VendaID { get; set; }
        public int NumeroParcela { get; set; }
        public DateTime DataVenda { get; set; }
        public DateTime DataVencimento { get; set; }
        public DateTime? DataPagamento { get; set; }
        public decimal ValorParcela { get; set; }
        public decimal ValorRecebido { get; set; }
        public decimal Juros { get; set; }
        public decimal Multa { get; set; }
        public decimal Saldo { get; set; }
        public string Status { get; set; }
        public string FormaPagamento { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ParcelaModel
    {
        public long ParcelaID { get; set; }
        public long VendaID { get; set; }
        public long NumeroParcela { get; set; }

        public DateTime DataVencimento { get; set; }

        // valores em CENTAVOS
        public decimal ValorParcela { get; set; }
        public decimal ValorRecebido { get; set; }
        public decimal Juros { get; set; }
        public decimal Multa { get; set; }

        public string Status { get; set; } = "Pendente";
        public DateTime? DataPagamento { get; set; }
        public string? Observacao { get; set; }

        // 🔹 propriedades auxiliares (NÃO MAPEADAS)
        public decimal ValorParcelaDec => ValorParcela;
        public decimal ValorRecebidoDec => ValorRecebido;
        public decimal JurosDec => Juros;
        public decimal MultaDec => Multa;

        public decimal TotalDec => ValorParcelaDec + JurosDec + MultaDec;
        public decimal SaldoDec => TotalDec - ValorRecebidoDec;
    }

}
﻿using System;
using System.Collections.Generic;
using System.Text;

namespace GVC.MODEL
{
    internal class PedidosMODEL
    {
        public int PedidoID { get; set; }
        public int FornecedorID { get; set; }
        public DateTime DataPedido { get; set; }
        public decimal ValorTotalPedido { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ProdutoEstoqueBaixo
    {
        public int ProdutoID { get; set; }
        public string NomeProduto { get; set; }
        public int Estoque { get; set; }
        public string Unidade { get; set; }
        public string Marca { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ProdutoLucrativo
    {
        public int ProdutoID { get; set; }
        public string NomeProduto { get; set; }
        public int Estoque { get; set; }
        public decimal PrecoCusto { get; set; }
        public decimal PrecoDeVenda { get; set; }
        public decimal LucroUnitario { get; set; }
        public decimal LucroTotal { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ProdutosModel
    {
        public long ProdutoID { get; set; }
        public string NomeProduto { get; set; } = string.Empty;
        public string? Referencia { get; set; }
        public decimal PrecoCusto { get; set; }
        public decimal Lucro { get; set; }
        public decimal PrecoDeVenda { get; set; }
        public long Estoque { get; set; }
        public DateTime DataDeEntrada { get; set; }
        public string Status { get; set; } = string.Empty;
        public string? Situacao { get; set; }
        public string? Unidade { get; set; }
        public string? Marca { get; set; }
        public DateTime? DataValidade { get; set; }
        public string? GtinEan { get; set; }
        public string? Imagem { get; set; }
        public long FornecedorID { get; set; }
        public string? Fornecedor { get; set; }

        // 🔎 Propriedades calculadas
        public decimal MargemLucro =>
            PrecoCusto > 0 ? (PrecoDeVenda - PrecoCusto) / PrecoCusto * 100 : 0;

        public bool EstoqueBaixo => Estoque <= 10;

        public string ProdutoExibicao
        {
            get
            {
                return $"{ProdutoID:000000} | {NomeProduto} | {Unidade} | R$ {PrecoDeVenda:N2}";
            }
        }

    }

}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    internal class RecebimentoModel
    {
        public Guid RecebimentoID { get; set; }
        public Guid VendaID { get; set; }
        public DateTime? DataRecebimento { get; set; }
        public decimal? ValorRecebido { get; set; }
        public Guid ParcelaID { get; set; }
        public Guid ContaReceberID { get; set; }
        public DateTime? DataRegistro { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class ResultadoVenda
    {
        public bool Sucesso { get; set; }
        public int VendaID { get; set; }
        public string Mensagem { get; set; }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    internal class UsuarioMODEL
    {
        public int UsuarioID { get; set; }
        public string NomeCompleto { get; set; }   // novo campo: nome real da pessoa
        public string NomeUsuario { get; set; }    // login/username
        public string Email { get; set; }
        public string Senha { get; set; }          // lembre-se: armazenar hash, não senha pura
        public string TipoUsuario { get; set; }    // Normal, Admin, etc.
        public string Cpf { get; set; }
        public DateTime DataNascimento { get; set; }
        public DateTime DataCriacao { get; set; }  // novo campo: data de cadastro no sistema
    }

}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class VendaCompletaModel
    {
        public long VendaID { get; set; }
        public int ClienteID { get; set; }
        public string ClienteNome { get; set; }
        public string CpfCliente { get; set; }
        public decimal ValorTotal { get; set; }
        public decimal Desconto { get; set; }
        public int FormaPgtoID { get; set; } // 🔥 AQUI
        public string Observacoes { get; set; }

        public List<ItemVendaModel> Itens { get; set; }
        public List<ParcelaModel> Parcelas { get; set; }
    }

}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GVC.MODEL
{
    public class VendaModel
    {
        public long VendaID { get; set; }
        public long ClienteID { get; set; }
        public long? FormaPgtoID { get; set; }
        public DateTime DataVenda { get; set; }
        public decimal ValorTotal { get; set; }
        public decimal? Desconto { get; set; } = 0;
        public string Observacoes { get; set; }
        public string StatusVenda { get; set; } = "Finalizada";
        public int? VendedorID { get; set; }


        public List<ItemVendaModel> ItensVendidos { get; set; }
        public List<ParcelaModel> Parcelas { get; set; }

        public VendaModel()
        {
            ItensVendidos = new List<ItemVendaModel>();
            Parcelas = new List<ParcelaModel>();
        }

        public string NomeCliente { get; set; }
    }
}
